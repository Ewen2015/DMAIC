---
title: "EDA"
author: "Enqun Wang (EW), Yiyan Zhou (YZ)"
date: "May 3, 2016"
output: html_document
---

#### Input the data

```{r message=FALSE}
setwd("/Users/ewenwang/Dropbox/Data Science/DMAIC/Case Study/3-Analyze")

require(dplyr)

df = data.frame(read.csv("data.csv", header = T)[-c(1:4),-c(2:3)])
```

#### Preprocess data

```{r}
require(caret)

trans = preProcess(df[,-1], c("BoxCox", "center", "scale"))
predictorsTrans = data.frame(trans = predict(trans, df[,-1]))

X = predictorsTrans[,-1]
y = predictorsTrans[,1]
trans.df = data.frame(data = df[,1], y, X)
```

Based on cause and effect relationship, we divide the variales into four causes.

```{r}
X.market = X[, c(8, 10, 11, 12)]
X.product = X[, c(1, 2, 5, 6)]
X.promotion = X[, c(7, 8)]
X.platform = X[, c(3, 4)]
```

#### Detect dependent variables

```{r}
panel.cor <- function(x, y, digits = 2, cex.cor, ...) {
  usr <- par("usr")
  on.exit(par(usr))
  par(usr = c(0, 1, 0, 1))
  # correlation coefficient
  r <- cor(x, y)
  txt <- format(c(r, 0.123456789), digits = digits)[1]
  txt <- paste("r= ", txt, sep = "")
  text(0.5, 0.6, txt)
  # p-value calculation
  p <- cor.test(x, y)$p.value
  txt2 <- format(c(p, 0.123456789), digits = digits)[1]
  txt2 <- paste("p= ", txt2, sep = "")
  if (p < 0.01) 
    txt2 <- paste("p= ", "<0.01", sep = "")
  text(0.5, 0.4, txt2)
}

pairs(X, pch = 19, upper.panel = panel.cor)
```

According to the correlation plot above, we find that `interbank.Rate` , `SHIBOR`, `SHA`, and `GEM` are highly correlated. So we consider if we could remove some of them. 

Based on the voice of costumers, we decided to remove `interbank.Rate`, which can be represented by `SHIBOR`. However, we would retain `SHA` and `GEM`, since they reflect different fields in financail market. 

#### 

```{r}
require(ggplot2)
require(reshape2)

df = data.frame(read.csv("data.csv", header = T)[-c(1:4),-c(2:3)])
trans = preProcess(df[,-1], c("BoxCox", "center", "scale"))
predictorsTrans = data.frame(date = df[,1], trans = predict(trans, df))

meltdf <- melt(predictorsTrans, "date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line()
```














